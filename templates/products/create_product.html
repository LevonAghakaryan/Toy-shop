{% extends "base.html" %}

{% block title %}FreshMarket | Ավելացնել Ապրանք{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-6 py-12">
    <header class="text-center mb-10">
        <h1 class="text-4xl font-extrabold text-indigo-700">Ավելացնել Նոր Ապրանք ➕</h1>
        <p class="text-lg text-gray-600 mt-2">Լրացրեք բոլոր դաշտերը պահեստային քանակի հետ միասին:</p>
    </header>

    <div id="status-message" class="hidden p-4 mb-4 text-sm rounded-lg" role="alert"></div>

    <form id="create-product-form" class="bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
        
        <div class="mb-5">
            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Անվանումը</label>
            <input type="text" id="name" name="name" required
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
        </div>

        <div class="mb-5">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Նկարագրություն</label>
            <textarea id="description" name="description" rows="3"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"></textarea>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-5">
            <div class="col-span-1">
                <label for="price" class="block text-sm font-medium text-gray-700 mb-1">Գինը (֏)</label>
                <input type="number" id="price" name="price" step="0.01" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            
            <div class="col-span-1">
                <label for="stock_quantity" class="block text-sm font-medium text-gray-700 mb-1">Քանակը Պահեստում</label>
                <input type="number" id="stock_quantity" name="stock_quantity" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            
            <div class="col-span-1">
                <label for="category_id" class="block text-sm font-medium text-gray-700 mb-1">Կատեգորիա ID</label>
                <input type="number" id="category_id" name="category_id" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
            </div>
        </div>
        
        <div class="mb-5">
            <label for="img_url" class="block text-sm font-medium text-gray-700 mb-1">Նկարի URL (ըստ ցանկության)</label>
            <input type="text" id="img_url" name="img_url"
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
        </div>

        <button type="submit"
                class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-300">
            Պահպանել Ապրանքը
        </button>
    </form>
</div>

<script>
    document.getElementById('create-product-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const form = e.target;
        const statusMessage = document.getElementById('status-message');
        
        // Ձևաթղթի տվյալները հավաքել որպես JSON
        const productData = {
            name: form.name.value,
            description: form.description.value || null,
            price: parseFloat(form.price.value),
            img_url: form.img_url.value || null,
            stock_quantity: parseInt(form.stock_quantity.value),
            category_id: parseInt(form.category_id.value)
        };

        try {
            const response = await fetch('/products/', { // ՈՒՇԱԴՐՈՒԹՅՈՒՆ: Սա պետք է համապատասխանի Ձեր POST ռոուտին
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(productData)
            });

            const result = await response.json();

            if (response.ok) {
                statusMessage.textContent = `✅ Ապրանքը հաջողությամբ ստեղծվեց։ ID: ${result.id}, Անվանում: ${result.name}`;
                statusMessage.className = 'p-4 mb-4 text-sm text-green-700 bg-green-100 rounded-lg hidden';
                statusMessage.style.display = 'block';
                form.reset(); // Մաքրել ձևաթուղթը
            } else {
                // Սխալի մշակում FastAPI-ի կողմից
                const detail = result.detail || 'Անհայտ սխալ։';
                statusMessage.textContent = `❌ Սխալ: ${detail}`;
                statusMessage.className = 'p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg hidden';
                statusMessage.style.display = 'block';
            }
        } catch (error) {
            statusMessage.textContent = '❌ Ցանցային սխալ կամ սերվերի հետ կապի խնդիր։';
            statusMessage.className = 'p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg hidden';
            statusMessage.style.display = 'block';
        }
    });
</script>
{% endblock %}